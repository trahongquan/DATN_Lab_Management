<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Thông tin tài khoản</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.min.css">
    <!--<link rel="stylesheet" href="/css/Header.css">-->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" >
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="/js/header.js"></script>
    <script src="/js/headernew/headernew.js"></script>


</head>
<body >
<div th:replace="headernew :: header"></div>
<account-info>
    <div class="container" style="margin-top: 100px">
        <div style="display: flex; justify-content: center">
            <h1 class="font-weight-bold text-uppercase">Thông tin tài khoản</h1>
        </div>
        <br>
        <div class="row">
            <div class="col-md-6">
                <h2>Thông tin cá nhân</h2>
                <table class="table">
                    <thead>
                    <tr>
                        <th>Họ Tên</th>
                        <td th:text="${peopleDTO.getName}"></td>
                    </tr>
                    <tr>
                        <th>Cấp bậc</th>
                        <td th:text="${peopleDTO.getRank}"></td>
                    </tr>
                    <tr>
                        <th>Đơn vị</th>
                        <td th:text="${peopleDTO.getUnit}"></td>
                    </tr>
                    <tr>
                        <th>Liên hệ</th>
                        <td th:text="${peopleDTO.getContact}"></td>
                    </tr>
                    </thead>
                </table>
            </div>
            <div class="col-md-6">
                <h2>Thông tin tài khoản</h2>
                <table class="table">
                    <thead>
                    <tr>
                        <th>Tên đăng nhập</th>
                        <td th:text="${peopleDTO.getUser.getUsername}">
                        </td>
                    </tr>
                    <tr>
                        <th class="col-3 justify-content-center align-content-center">
                            <p th:text="'Mật khẩu'" style="margin: auto"></p>
                        </th>
                        <td sec:authorize="hasAnyRole('ROLE_ADMIN','ROLE_MANAGER')" class="col-9">
                            <form th:action="@{/Lab/admin/myAccount}" method="post" class="d-flex justify-content-center align-content-center flex-column">
                                <div class="row justify-content-center align-items-center">
                                    <input type="password" class="col-7 m-1 form-control"
                                           name="oldpass" placeholder="Nhập mật khẩu cũ" id="oldpass"
                                           style="width: 66%; margin: unset; border: 1px solid lightgray;">
                                    <input type="hidden" th:value="${peopleDTO.getUser.getUsername}" name="username">
                                    <button type="submit" class="btn btn-primary col-3 m-1"
                                            onclick="return confirm('Bạn có chắc chắn đổi mật khẩu?')">Đổi MK
                                    </button>
                                </div>
                                <div class="row justify-content-center align-content-center">
                                    <input type="password" style="width: 95%;" name="newpass" id="newpass" class="col-5 m-1 form-control" placeholder="Nhập mật khẩu mới" >
                                    <input type="password" style="width: 95%;" name="retypenewpass" id="retypenewpass" class="col-5 m-1 form-control" placeholder="Nhập lại mật khẩu mới" >
                                    <!--<button onclick="checkPasswordValidity()" type="button" class="btn btn-gradient-success col-4">Check</button>-->
                                </div>
                            </form>
                        </td>
                        <td sec:authorize="hasAnyRole('ROLE_TEACHER','ROLE_RESERVATIONIST')" class="col-9">
                            <form th:action="@{/Lab/myAccount}" method="post" class="d-flex justify-content-center align-content-center flex-column">
                                <div class="row justify-content-center align-items-center">
                                    <input type="password" class="col-7 m-1 form-control"
                                           name="oldpass" placeholder="Nhập mật khẩu cũ" id="oldpass"
                                           style="width: 66%; margin: unset; border: 1px solid lightgray;">
                                    <input type="hidden" th:value="${peopleDTO.getUser.getUsername}" name="username">
                                    <button type="submit" class="btn btn-primary col-3 m-1"
                                            onclick="return confirm('Bạn có chắc chắn đổi mật khẩu?')">Đổi MK
                                    </button>
                                </div>
                                <div class="row justify-content-center align-content-center">
                                    <input type="password" style="width: 95%;" name="newpass" id="newpass" class="col-6 m-1 form-control" placeholder="Nhập mật khẩu mới" >
                                    <input type="password" style="width: 95%;" name="retypenewpass" id="retypenewpass" class="col-6 m-1 form-control" placeholder="Nhập lại mật khẩu mới" >
                                    <!--<button onclick="checkPasswordValidity()" type="button" class="btn btn-gradient-success col-4">Check</button>-->
                                </div>
                            </form>
                        </td>
                    </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>

    <br>
    <br>
    <br>
    <h2 class="text-center font-weight-bold text-uppercase"
        th:if="${#strings.contains(#request.requestURI, '/Lab/admin/myAccount/')}"
        >Danh sách các phòng thí nghiệm cho tài khoản này quản lý</h2>
    <br>
    <div class="main-card mb-3 card" th:if="${#strings.contains(#request.requestURI, '/Lab/admin/myAccount/')}">
        <div class="card-body">
            <table style="width: 100%;" id="popup-example" class="table table-hover table-striped table-bordered">
                <thead>
                <tr>
                    <th>STT</th>
                    <th>Tên PTN</th>
                    <th>Vị trí</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="lab, iter : ${labs}">
                    <td th:text="${iter.index+1}"></td>
                    <td>
                        <a th:href="'/Lab/admin/room/showFormForUpdate/'+${lab.id}">
                            <span class="text-primary font-weight-bold" th:text="${lab.labName}"></span>
                        </a>
                    </td>
                    <td th:text="${lab.location}"></td>
                </tbody>
                <tfoot>
                <tr>
                    <th>STT</th>
                    <th>Tên PTN</th>
                    <th>Vị trí</th>
                </tr>
                </tfoot>
            </table>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <!--TABLES -->
    <!--DataTables-->
    <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/datatables.net-bs4@1.10.19/js/dataTables.bootstrap4.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.3/js/responsive.bootstrap.min.js" crossorigin="anonymous"></script>
    <!--Bootstrap Tables-->
    <script th:src="@{/js/table/tablesInit.js}"></script>
    <!--Tables Init-->
    <script th:src="@{/js/table/tablesVendors.js}"></script>
    <script src="https://cdn.jsdelivr.net/npm/bcryptjs@2.4.3/dist/bcrypt.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bcryptjs@2.4.3/dist/bcrypt.min.js"></script>

    <script th:inline="javascript">
            $('.container-xxxl').removeClass('container')
        $(document).ready(function () {

            $('#eye, #eye-slash').click(function() {
                togglePasswordVisibility();
            });
            function togglePasswordVisibility() {
                var passwordInput = $(".passCustomer");
                if (passwordInput.attr("type") === "text") {
                    passwordInput.attr("type", "password");
                    console.log("type = password");
                    $('#eye').css({'display':'block'})
                    $('#eye-slash').css({'display':'none'})
                } else {
                    passwordInput.attr("type", "text");
                    console.log("type = text");
                    $('#eye').css({'display':'none'})
                    $('#eye-slash').css({'display':'block'})
                }
            }
        })
/*        function checkPasswordValidity() {
            var hashedPassword = [[${peopleDTO.getUser.getPassword}]];
            console.log(hashedPassword);
            var enteredPassword = document.getElementById("passwordInput").value;
            // var x = bcrypt.compare(enteredPassword, hashedPassword);
            console.log("đã bấm");
            bcrypt.compare(enteredPassword, hashedPassword, function(err, result) {
                if (result === true) {
                    console.log("Mật khẩu hợp lệ");
                } else {
                    console.log("Mật khẩu không hợp lệ");
                }
            });
        }*/
    </script>
    <div th:if="${changedPassfalse}" style="display: flex; justify-content: flex-end; align-items: flex-end;
                                position: fixed; top: 150px; right: 10px;
                                background: linear-gradient(45deg, rgba(229,191,22,0.45), rgba(152,229,18,0.45));">
        <p id="changedPass" style="padding: 15px;
                                border: 1px solid transparent;
                                border-radius: 4px;
                                color: #721c24;
                                border-color: black;
                                margin-bottom: 0;
                                font-weight: bold;"> Mật khẩu cũ không chính xác (<span id="changedPasscountdown">3</span>)</p>
    </div>
    <script>
        var countdownchangedPass = 3; // Số giây còn lại
        var countdownElementchangedPass = document.getElementById("changedPasscountdown");
        // Cập nhật số giây còn lại và ẩn thông báo khi hết thời gian
        var countdownIntervalchangedPass = setInterval(function() {
            countdownchangedPass--;
            countdownElementchangedPass.textContent = countdownchangedPass;
            if (countdownchangedPass < 0) {
                document.getElementById("changedPass").style.display = "none";
                clearInterval(countdownIntervalchangedPass);
            }
        }, 1000);
        /*$(document).ready(function () {
            setTimeout(function () {
                $('#example_filter').css({
                    'display': 'flex',
                    'justify-content': 'end',
                });
            }, 3000);
        })*/

    </script>
</account-info>

<br>
<br>
<!--<div th:replace="footer :: footer"></div>-->

</body>
</html>
